<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v6.1.1/css/all.css"
        integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" /> -->

<script src="https://kit.fontawesome.com/73db2f45cc.js" crossorigin="anonymous"></script>


<style>

body {
  font-family: 'Segoe UI', sans-serif;
  background: #121212;
  color: #f5f5f5;
  padding: 20px;
}

h2 {
  color: #ffffff;
  text-align: center;
}

.form-container, .output-container {
  background: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
  max-width: 600px;
  margin: 20px auto;
}

label {
  display: block;
  margin-top: 12px;
  font-weight: bold;
  color: #e0e0e0;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  background-color: #2a2a2a;
  border: 1px solid #444;
  color: #fff;
  border-radius: 8px;
}

input::placeholder,
textarea::placeholder {
  color: #aaa;
}

button {
  margin-top: 15px;
  padding: 12px 20px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

button:hover {
  background-color: #43a047;
}

pre {
  background: #2a2a2a;
  padding: 15px;
  border-radius: 8px;
  overflow-x: auto;
  white-space: pre-wrap;
  color: #e0e0e0;
  font-family: Consolas, monospace;
}

.copied {
  color: #81c784;
  font-size: 0.9em;
  margin-left: 10px;
}
</style>


   <link rel="stylesheet" href="/masjid/gaya.css">


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>


    <title>input Kas Masjid Al-Huda Tanjung Bulan</title>
</head>


    <body class="bg-dark text-light">


                <div class="col-lg-3 d-flex flex-column align-items-center justify-content-center border-custom py-4">



        <div class="d-block border-light border border-2 rounded-circle overflow-hidden" style="width: 8em;"
                data-bs-toggle="modal" data-bs-target="#showImage" id="profile">

                <img class="img-fluid">
            </div>
            <span class="pt-3 text-center">

                 <h1><i class="fas fa-wallet">

    </i>Input Kas Masjid</h1>

            </span>



       </div>

    <!-- Modal -->
    <div class="modal fade" id="showImage" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="showImageLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="showImageLabel">RISMA Tanjung Bulan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <img class="img-fluid img-thumbnail profile">
                </div>
            </div>
        </div>
    </div> 

    <script>
        // * img position
        const position = '/img/risma_1.png';

        // ! Don't change this line
        $(document).ready(() => {
            $('#profile img').attr('src', position);
        });
    </script>

    <center>


<!--
    <script>
        // list links
        const links = [
            
            
            {

                url: 'jadwal.html',
                icon: 'fas fa-calendar-alt',
                text: 'Jadwal Pertandingan',
            },
           
            
            {

                url: 'hasil.html',
                icon: 'fas fa-hourglass-end',
                text: 'Hasil Pertandingan',
            },

            
           
        ];

        // ! Don't change this line
        $(document).ready(() => {
            const callbackMap = (element, i) => {
                return  /*html*/`
                <li class="my-3 py-3 px-5 border border-light">
                    <a target="" href="${element.url}" class="text-decoration-none"
                        style="font-weight: 450;">
                        <i class="fa-fw ${element.icon}"></i>
                        ${element.text}
                    </a>
                </li>
                `;
            };
            $('.list-unstyled.links').append($.map(links, callbackMap));
        });
    </script>

 -->






    </center>


    <script>
        $(document).ready(() => {
            $('#profile').on('click', () => {
                $('img.img-fluid.profile').attr('src',
                    $('#profile img').attr('src')
                );
            })
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>




        <center>



<p id="last-updated" style="font-style: italic; font-size: 14px;"></p>

<script>
  const updatedAt = new Date(document.lastModified);
  const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute:'2-digit' };
  document.getElementById("last-updated").innerText = "Terakhir diperbarui: " + updatedAt.toLocaleDateString('id-ID', options);
</script>





  <div class="container">
    <h2>Laporan Kas Masjid Al-Huda</h2><div class="section">
  <h3>Laporan Bulanan</h3>
  <label for="bulan">Pilih Bulan:</label>
  <select id="bulan"></select>
  <button onclick="generateMonthlyReport()">Buat Laporan Bulanan</button>
</div>

<div class="section">
  <h3>Laporan Tahunan (Idul Fitri)</h3>
  <label>Pilih Transaksi:</label>
  <div id="checklist"></div>
  <button onclick="generateYearlyReport()">Buat Laporan Tahunan</button>
</div>

<div class="section">
  <h3>Hasil Laporan</h3>
  <textarea id="reportOutput" readonly></textarea>
  <button onclick="copyReport()">ðŸ“‹ Salin ke Clipboard</button>
  <button onclick="sendToWhatsApp()">ðŸ“¤ Kirim ke WhatsApp</button>
</div>

  </div>  <script src="kas.js"></script>  <script src="fungsi.js"></script>  <script>
    const bulanSelect = document.getElementById("bulan");
    const checklist = document.getElementById("checklist");
    const output = document.getElementById("reportOutput");

    function getMonthName(monthIndex) {
      return new Date(2025, monthIndex, 1).toLocaleString("id-ID", { month: "long" });
    }

    function populateMonthOptions() {
      for (let i = 0; i < 12; i++) {
        const option = document.createElement("option");
        option.value = i + 1;
        option.textContent = getMonthName(i);
        bulanSelect.appendChild(option);
      }
    }

    function populateChecklist() {
      const txs = getRawTransactions();
      checklist.innerHTML = "";
      txs.forEach((t, i) => {
        const label = document.createElement("label");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = i;
        label.appendChild(checkbox);
        label.append(` ${t.date} - ${t.description}`);
        checklist.appendChild(label);
        checklist.appendChild(document.createElement("br"));
      });
    }

    function generateMonthlyReport() {
      const month = parseInt(bulanSelect.value);
      const year = 2025;
      const txs = getRawTransactions().filter(t => new Date(t.date).getMonth() + 1 === month);
      const bulanNama = getMonthName(month - 1);

      const pemasukan = txs.filter(t => t.type === "income");
      const pengeluaran = txs.filter(t => t.type === "expense");
      const totalIn = pemasukan.reduce((s, t) => s + t.amount, 0);
      const totalOut = pengeluaran.reduce((s, t) => s + t.amount, 0);

      let saldoAwal = 0;
      const all = computeLedger();
      const firstOfMonth = all.find(t => new Date(t.date).getMonth() + 1 === month);
      if (firstOfMonth) {
        saldoAwal = firstOfMonth.balanceAfter - (firstOfMonth.type === "income" ? firstOfMonth.amount : -firstOfMonth.amount);
      }
      const saldoAkhir = saldoAwal + totalIn - totalOut;

      const lines = [
        `ðŸ•Œ Laporan Kas Masjid Al-Huda Bulan ${bulanNama} ${year}`,
        `\nðŸ’° Saldo Awal Bulan: ${saldoAwal.toLocaleString("id-ID")}`,
        `\nðŸ“¥ Pemasukan:`
      ];
      pemasukan.forEach(p => lines.push(`- ${p.description}: ${p.amount.toLocaleString("id-ID")}`));
      lines.push(`\nTotal Pemasukan : ${totalIn.toLocaleString("id-ID")}`);
      lines.push(`\nðŸ“¤ Pengeluaran:`);
      pengeluaran.forEach(p => lines.push(`- ${p.description}: ${p.amount.toLocaleString("id-ID")}`));
      lines.push(`\nTotal pengeluaran: ${totalOut.toLocaleString("id-ID")}`);
      lines.push(`\nðŸ’° Saldo akhir bulan: ${saldoAkhir.toLocaleString("id-ID")}`);
      lines.push(`\nðŸ“…Periode: ${bulanNama} ${year}`);
      lines.push(`\nðŸ“Œ Info: https://tanjungbulan.my.id/masjid`);

      output.value = lines.join("\n");
    }

    function generateYearlyReport() {
      const checked = Array.from(checklist.querySelectorAll("input:checked"))
        .map(cb => parseInt(cb.value));
      const all = getRawTransactions();
      const selected = checked.map(i => all[i]);
      const pemasukan = selected.filter(t => t.type === "income");
      const pengeluaran = selected.filter(t => t.type === "expense");
      const totalIn = pemasukan.reduce((s, t) => s + t.amount, 0);
      const totalOut = pengeluaran.reduce((s, t) => s + t.amount, 0);
      const saldoAwal = 0;
      const saldoAkhir = saldoAwal + totalIn - totalOut;

      const lines = [
        `ðŸ“¢ Laporan Tahunan Kas Masjid Al-Huda 1448 H`,
        `\nðŸ’°Saldo Awal: ${saldoAwal.toLocaleString("id-ID")}`,
        `\nðŸŸ¢ Pemasukan:`
      ];
      pemasukan.forEach(p => lines.push(`+ ${p.description}: ${p.amount.toLocaleString("id-ID")}`));
      lines.push(`\nTotal Pemasukan: ${totalIn.toLocaleString("id-ID")}`);
      lines.push(`\nðŸ”´ Pengeluaran:`);
      pengeluaran.forEach(p => lines.push(`- ${p.description}: ${p.amount.toLocaleString("id-ID")}`));
      lines.push(`\nTotal pengeluaran: ${totalOut.toLocaleString("id-ID")}`);
      lines.push(`\nðŸ’³ Saldo akhir: ${saldoAkhir.toLocaleString("id-ID")}`);
      lines.push(`\nðŸ“…Periode : [tanggal hijriah]`);
      lines.push(`\nðŸ“ŒInfo: https://tanjungbulan.my.id/masjid`);

      output.value = lines.join("\n");
    }

    function copyReport() {
      output.select();
      document.execCommand("copy");
      alert("Teks laporan disalin ke clipboard.");
    }

    function sendToWhatsApp() {
      const text = encodeURIComponent(output.value);
      const url = `https://wa.me/?text=${text}`;
      window.open(url, '_blank');
    }

    document.addEventListener("DOMContentLoaded", () => {
      populateMonthOptions();
      populateChecklist();
    });
  </script>



    </body>

    </html>